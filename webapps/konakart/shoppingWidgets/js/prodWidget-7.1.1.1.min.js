var kkRoot="http://localhost:8780/konakart/",jsonProtocol="json",kkImgBase=kkRoot+"images/",kkScriptBase=kkRoot+"shoppingWidgets/js/",kkCSSBase=kkRoot+"shoppingWidgets/css/",jqueryLib="jquery-1.7.2.min.js",jqueryUILib="jquery-ui-1.8.20.custom.min.js",jqueryJsonLib="jquery.json-2.3.min.js",jqueryKKLib="jquery.konakart-7.1.1.1.min.js",jqueryUICSS="jquery-ui-1.8.20.custom.css",kkCSS="kkWidget.css",kkMsgCartEmpty="Your Cart is Empty",kkMsgImage="Image",kkMsgDetails="Details",kkMsgCart="Cart",kkMsgReviews=
"Reviews",kkMsgItem="Item",kkMsgQty="Qty",kkMsgCost="Cost",kkMsgRemove="Remove",kkMsgCheckout="Checkout",kkMsgAddToCart="Add To Cart",kkMsgTotal="Total",kkMsgInc="Increase the quantity",kkMsgDec="Decrease the quantity",kkMsgRemove="Remove the item from the cart",KK_PROD_ID="kkProdId",KK_AFFILIATE_ID="kkAffiliateId",kkNumLibs=3,kkLibsLoaded=0;typeof jQuery=="undefined"?kkLoadJquery(kkScriptBase+jqueryLib):kkJQueryLoadedCallback();
var kkTabs=[],kkCheckoutBtns=[],KK_CUSTOMER_ID="KK_CUSTOMER_ID",DEFAULT_LANG=-1,kkEngine,kkCustId=null,kkAffiliateId=null,optionMap={},defaultCurrency=null;
function kkLoadJS(a){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",a);b.readyState?b.onreadystatechange=function(){if(b.readyState=="loaded"||b.readyState=="complete")b.onreadystatechange=null,kkLibLoadedCallback()}:b.onload=function(){kkLibLoadedCallback()};typeof b!="undefined"&&(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(b)}
function kkLoadJquery(a){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src",a);b.readyState?b.onreadystatechange=function(){if(b.readyState=="loaded"||b.readyState=="complete")b.onreadystatechange=null,kkJQueryLoadedCallback()}:b.onload=function(){kkJQueryLoadedCallback()};typeof b!="undefined"&&(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(b)}
function kkLoadCSS(a){var b=document.createElement("link");b.setAttribute("type","text/css");b.setAttribute("href",a);b.setAttribute("rel","stylesheet");document.getElementsByTagName("head")[0].appendChild(b)}function kkLibLoadedCallback(){kkLibsLoaded+=1;kkLibsLoaded==kkNumLibs&&(initKK(),renderKKProds())}
function kkJQueryLoadedCallback(){kkLoadCSS(kkCSSBase+jqueryUICSS);kkLoadCSS(kkCSSBase+kkCSS);kkLoadJS(kkScriptBase+jqueryUILib);kkLoadJS(kkScriptBase+jqueryJsonLib);kkLoadJS(kkScriptBase+jqueryKKLib)}var kkGetTempCustomerIdCallback=function(a){kkCustId=decodeJson(a);setKKCookie(KK_CUSTOMER_ID,kkCustId,30)},kkGetDefaultCurrencyCallback=function(a){defaultCurrency=decodeJson(a)};
function initKK(){var a=new engineConfig(kkRoot+"konakartjson");a.storeId="store1";a.protocol=jsonProtocol;kkEngine=new kkEng(a);jsonProtocol=="json"&&ieCORSSupport();kkEng.getDefaultCurrency(kkGetDefaultCurrencyCallback,null,kkEngine);a=getKKCookie(KK_CUSTOMER_ID);a==null?kkEng.getTempCustomerId(kkGetTempCustomerIdCallback,null,kkEngine):kkCustId=a}
function ieCORSSupport(){!jQuery.support.cors&&window.XDomainRequest&&$.ajaxTransport("json",function(a){var b=null;return{send:function(e,c){b=new XDomainRequest;b.onload=function(){c(200,"success",{text:b.responseText})};b.onerror=b.ontimeout=function(){c(400,"failed",{text:b.responseText})};b.open(a.type,a.url);b.send(a.data)},abort:function(){b&&b.abort()}}})}
function renderKKProds(){$(".kk-prod").each(function(a,b){var e=$(b).attr(KK_PROD_ID);kkAffiliateId||(kkAffiliateId=$(b).attr(KK_AFFILIATE_ID));e&&renderKKProd(b,e)})}function renderKKProd(a,b){kkEng.getProduct(null,b,DEFAULT_LANG,getKKProductCallback,a,kkEngine)}
var getKKProductCallback=function(a){var a=decodeJson(a),b=a.id,e="kk-container-"+b,c="kk-tabs-"+b,d="kk-img-tab-"+b,i="kk-detail-tab-"+b,g="kk-cart-tab-"+b;$(this).append('<div id="'+e+'" ><div class="kk-tabs" id="'+c+'"><ul></ul></div></div>');kkTabs[b]=$("#"+c).tabs();kkTabs[b].tabs("add","#"+d,kkMsgImage);kkTabs[b].tabs("add","#"+i,kkMsgDetails);kkTabs[b].tabs("add","#"+g,kkMsgCart);renderKKImgTab(c,d,a);if(a!="")renderKKDetailTab(c,i,a),renderKKCartTab(c,g,a),getBasketItemsPerCustomer(),b=new DataDescriptor,
b.limit=10,b.orderBy="ORDER_BY_DATE_ADDED_DESCENDING",kkEng.getReviewsPerProduct(b,a.id,getKKReviewsCallback,a,kkEngine)};function getBasketItemsPerCustomer(){kkCustId!=null&&kkCustId<0&&(kkEng.getBasketItemsPerCustomer(null,kkCustId,DEFAULT_LANG,kkGetBasketItemsPerCustomerCallback,null,kkEngine),$(".kk-prod").each(function(a,b){var e=$(b).attr(KK_PROD_ID);$("#kk-cart-total-"+e).find("tbody").find("td:nth-child(2)").html('<img src="'+kkScriptBase+'../images/loader.gif">')}))}
var getKKReviewsCallback=function(a){var a=decodeJson(a),b=this.id;if(a&&a.reviewArray&&a.reviewArray.length>0){var e="kk-tabs-"+b,c="kk-review-tab-"+b;kkTabs[b].tabs("add","#"+c,kkMsgReviews);renderKKReviewsTab(e,c,this,a.reviewArray)}};
function renderKKImgTab(a,b,e){if(e=="")$("#"+a).find("#"+b).append("Product not found");else{for(var c=e.id,d='<div class="kk-img-content" id="kk-imgcontent-'+c+'"><div id="kk-gallery-'+c+'"><div id="kk-gallery-output-'+c+'">',i=1;i<5;i++){var g=kkImgBase+e.imageDir+e.uuid;g&&(g=g+"_"+i+"_big.jpg",d+='<img id="img-'+c+"-"+i+'" src="'+g+'" class="kk-large-img" />')}d+='</div><div id="kk-gallery-nav-'+c+'">';for(i=1;i<5;i++)if(g=kkImgBase+e.imageDir+e.uuid)g=g+"_"+i+"_tiny.jpg",d+='<a rel="img-'+c+
"-"+i+'" href="javascript:;"><img src="'+g+'" class="kk-small-img"/></a>';d+='</div><div class="clear"></div></div></div>';$("#"+a).find("#"+b).append(d);$("#kk-gallery-output-"+c+" img").not(":first").hide();$("#kk-gallery-"+c+" a").click(function(){$("#"+this.rel).is(":hidden")&&($("#kk-gallery-output-"+c+" img").slideUp(),$("#"+this.rel).slideDown())});kkAddAddToCartFooter(a,b,e)}}
function renderKKDetailTab(a,b,e){var c=e.id,d='<div class="kk-detail-content" id="kk-detail-content-'+c+'">';d+=e.description;if(e.opts&&e.opts.length>0){var i=-1;d+='<table width="100%">';for(var g=0;g<e.opts.length;g++){var f=e.opts[g];if(i!=f.id)i!=-1&&(d+="</select></td></tr>"),d+="<tr><td><span>"+f.name+"</span>:</td>",d+='<td><select id="'+("kk-"+c+"-"+f.id)+'">',i=f.id;var h="";f.priceExTax!=0&&(h+=" ("+(f.priceExTax<0?"-":"+")+kkFormatCurrency(f.priceExTax)+")");var j="kk-"+c+"-"+f.id+"-"+
f.valueId;d+='<option class="kk-option-'+c+'" id="'+j+'" value="'+f.valueId+'">'+f.value+h+"</option>";optionMap[j]=f}d+="</select></td></tr>";d+="</table>"}d+="</div>";$("#"+a).find("#"+b).append(d);kkAddAddToCartFooter(a,b,e)}
function renderKKReviewsTab(a,b,e,c){for(var d='<div class="kk-reviews-content" id="kk-reviews-content-'+e.id+'">',i=0;i<c.length;i++){var g=c[i],f=new Date(g.dateAdded);d+='<div class="kk-review-header">';d+='<span style="padding-right:10px">'+g.customerName+"</span>";for(var h=0;h<g.rating;h++)d+='<span style="display: inline-block; vertical-align:middle;" class="ui-icon ui-icon-star"/>';for(h=g.rating;h<5;h++)d+='<span style="display: inline-block; vertical-align:middle;" class="ui-icon ui-state-disabled ui-icon-star"/>';
d+='<span style="float:right;">'+formatDate(f)+"</span>";d+="</div>";d+='<div class="kk-review-text"><br/>';d+=g.reviewText;d+="</div>"}$("#"+a).find("#"+b).append(d);kkAddAddToCartFooter(a,b,e)}
function renderKKCartTab(a,b,e){var e=e.id,c='<div class="kk-cart-empty" id="kk-cart-empty-'+e+'">'+kkMsgCartEmpty+"</div>";c+='<div class="kk-cart-content" id="kk-cart-content-'+e+'">';c+='<table class="kk-cart-content-table" id="kk-cart-content-'+e+'" width="100%" border="0">';c+="<thead>";c+='<tr class="ui-state-hover">';c+='<th class="first" style="width:20%;"><span class="hidden">'+kkMsgImage+"</span></th>";c+='<th style="width:50%;">'+kkMsgItem+"</th>";c+='<th colspan="2" style="width:20%;">'+
kkMsgQty+"</th>";c+='<th style="width:10%;">'+kkMsgCost+"</th>";c+='<th class="last" style="width:5%;"></th>';c+="</tr>";c+="</thead>";c+="<tbody>";c+="</tbody>";c+="</table></div>";c+='<div class="kk-cart-order-totals" id="kk-cart-order-totals-'+e+'">';c+='<table class="kk-cart-order-totals-table" id="kk-cart-order-totals-table-'+e+'" width="100%" border="0">';c+="<tbody></tbody>";c+="</table></div>";c+='<table class="kk-cart-total" id="kk-cart-total-'+e+'" width="100%" border="0">';c+="<tbody><tr>";
c+='<td class="kk-total-desc">';c+=kkMsgTotal;c+="</td>";c+="<td></td>";c+='<td width="30%"><a id="kk-checkout-'+e+'" href="" style="display: none">'+kkMsgCheckout+"</a></td>";c+="</tr></tbody>";c+="</table>";$("#"+a).find("#"+b).append(c);kkCheckoutBtns[e]=$("#kk-checkout-"+e).button();kkCheckoutBtns[e].hide();$(kkCheckoutBtns[e]).click(function(){var b=new SSOToken;b.customerId=kkCustId;kkEng.saveSSOToken(b,kkSaveSSOTokenCallback,null,kkEngine);return false})}
var kkSaveSSOTokenCallback=function(a){a=decodeJson(a);a=kkRoot+"InitFromToken.action?key="+a;kkAffiliateId&&(a+="&aid="+kkAffiliateId);top.window.location=a};
function kkAddAddToCartFooter(a,b,e){var c=e.id,d='<table class="kk-add-to-cart-footer"><tr>';d+='<td><span class="kk-prod-name">'+e.name+"</span></td>";d+='<td><span class="kk-prod-price">'+kkFormatCurrency(e.specialPriceExTax==null?e.priceExTax:e.specialPriceExTax)+"</span></td>";d+='<td><a class="kk-add-to-cart-button" id ="kk-add-to-cart-'+b+'" href="">'+kkMsgAddToCart+"</a></td>";d+="</tr></table>";$("#"+a).find("#"+b).append(d);a=$("#kk-add-to-cart-"+b).button();$(a).click(function(){var b=
new Basket;b.quantity=1;b.productId=c;var a=$(".kk-option-"+c);if(a&&a.length>0){for(var e=[],d=0,j=0;j<a.length;j++){var k=a[j];k.selected==true&&(k=optionMap[k.attributes.id.nodeValue])&&(e[d++]=k)}if(e.length>0)b.opts=e}kkEng.addToBasket(null,kkCustId,b,kkAddToBasketCallback,c,kkEngine);return false})}
var kkAddToBasketCallback=function(){getBasketItemsPerCustomer();kkTabs[this].tabs("select",2)},kkGetBasketItemsPerCustomerCallback=function(a){var b=decodeJson(a);$(".kk-prod").each(function(a,c){var d=$(c).attr(KK_PROD_ID),i=$("#kk-cart-content-"+d).find("tbody");i.find("tr").remove();if(b.length==0)kkCheckoutBtns[d].hide(),$("#kk-cart-content-"+d).hide(),$("#kk-cart-order-totals-"+d).hide(),$("#kk-cart-total-"+d).hide(),$("#kk-cart-empty-"+d).show();else{kkCheckoutBtns[d].show();$("#kk-cart-content-"+
d).show();$("#kk-cart-order-totals-"+d).show();$("#kk-cart-total-"+d).show();$("#kk-cart-empty-"+d).hide();for(var g=0,a=0;a<b.length;a++){var f=b[a],h="<tr>";h+='<td class="kk-first">';h+='<img src="'+kkImgBase+f.product.imageDir+f.product.uuid+'_1_tiny.jpg" class="kk-small-img" />';h+="</td>";h+="<td>";h+='<span class="kk-cart-product-name">'+f.product.name+"</span>";if(f.opts)for(var j=0;j<f.opts.length;j++){var k=f.opts[j];h+='<span class="kk-cart-option-name"><br>- '+k.name+" "+k.value+"</span>"}h+=
"</td>";h+='<td style="text-align:right;">';h+=f.quantity;h+="</td>";h+='<td  style="text-align:left;">';h+='<span title="'+kkMsgInc+'" class="ui-icon ui-state-disabled ui-icon-plus" id="kk-basketid-inc_'+d+"_"+f.id+"_"+(f.quantity+1)+'"></span>';h+='<span title="'+kkMsgDec+'"  class="ui-icon ui-state-disabled ui-icon-minus" id="kk-basketid-dec_'+d+"_"+f.id+"_"+(f.quantity-1)+'"></span>';h+="</td>";h+='<td style="text-align:right;">';h+=kkFormatCurrency(f.finalPriceExTax);h+="</td>";h+="<td>";h+=
'<a  title="'+kkMsgRemove+'" class="ui-icon ui-state-disabled ui-icon-close" id="kk-basketid-'+d+"_"+f.id+'"></a>';h+="</td>";h+="</tr>";i.append(h);g+=f.finalPriceExTax;$("#kk-basketid-"+d+"_"+f.id).unbind();$("#kk-basketid-"+d+"_"+f.id).bind("click",function(b){var a=new Basket;a.id=b.target.id.split("_")[1];kkEng.removeFromBasket(null,kkCustId,a,kkRemoveFromBasketCallback,d,kkEngine)});$("#kk-basketid-inc_"+d+"_"+f.id+"_"+(f.quantity+1)).unbind();$("#kk-basketid-inc_"+d+"_"+f.id+"_"+(f.quantity+
1)).bind("click",function(b){var a=new Basket,b=b.target.id.split("_");a.productId=b[1];a.id=b[2];a.quantity=b[3];kkEng.updateBasket(null,kkCustId,a,kkUpdateBasketCallback,d,kkEngine)});$("#kk-basketid-dec_"+d+"_"+f.id+"_"+(f.quantity-1)).unbind();$("#kk-basketid-dec_"+d+"_"+f.id+"_"+(f.quantity-1)).bind("click",function(b){var a=new Basket,b=b.target.id.split("_");a.productId=b[1];a.id=b[2];a.quantity=b[3];a.quantity>0?kkEng.updateBasket(null,kkCustId,a,kkUpdateBasketCallback,d,kkEngine):a.quantity==
0&&kkEng.removeFromBasket(null,kkCustId,a,kkRemoveFromBasketCallback,d,kkEngine)})}}});b.length>0&&createTempOrder(b);$(" .kk-cart-content .ui-icon").hover(function(){$(this).removeClass("ui-state-disabled")},function(){$(this).addClass("ui-state-disabled")})};
function createTempOrder(a){var b=new CreateOrderOptions;b.useDefaultCustomer=true;b.billingAddrId=-1;b.customerAddrId=-1;b.deliveryAddrId=-1;for(var e=0;e<a.length;e++)a[e].product=null;kkEng.createOrderWithOptions(null,a,b,DEFAULT_LANG,getKKOrderCallback,null,kkEngine)}
var getKKOrderCallback=function(a){if(a=decodeJson(a)){for(var b=0;b<a.orderProducts.length;b++)a.orderProducts[b].product.description=null;a.customerId=kkCustId;kkEng.getShippingQuotes(a,DEFAULT_LANG,getKKShippingQuotesCallback,a,kkEngine)}},getKKShippingQuotesCallback=function(a){if((a=decodeJson(a))&&a.length>0)this.shippingQuote=a[0],kkEng.getOrderTotals(this,DEFAULT_LANG,getKKPopulatedOrderCallback,this,kkEngine)},getKKPopulatedOrderCallback=function(a){var b=decodeJson(a);$(".kk-prod").each(function(a,
c){var d=$(c).attr(KK_PROD_ID),i=$("#kk-cart-order-totals-table-"+d).find("tbody");i.find("tr").remove();if(b){for(var g="",a=0;a<b.orderTotals.length;a++){var f=b.orderTotals[a];f.className=="ot_total"?$("#kk-cart-total-"+d).find("tbody").find("td:nth-child(2)").html('<span class="kk-prod-price">'+kkFormatCurrency(f.value)+"</span>"):(g+="<tr>",g+='<td class="kk-order-total-title">',g+=f.title,g+="</td>",g+="<td></td>",g+='<td class="kk-order-total-value">',g+=f.className=="ot_reward_points"?f.value:
f.className=="ot_free_product"?f.text:kkFormatCurrency(f.value),g+="</td></tr>")}i.append(g)}})},kkRemoveFromBasketCallback=function(){getBasketItemsPerCustomer();kkTabs[this].tabs("select",2)},kkUpdateBasketCallback=function(){getBasketItemsPerCustomer();kkTabs[this].tabs("select",2)};function setKKCookie(a,b,e){var c=new Date;c.setDate(c.getDate()+e);b=escape(b)+(e==null?"":"; expires="+c.toUTCString());document.cookie=a+"="+b}
function getKKCookie(a){var b,e,c,d=document.cookie.split(";");for(b=0;b<d.length;b++)if(e=d[b].substr(0,d[b].indexOf("=")),c=d[b].substr(d[b].indexOf("=")+1),e=e.replace(/^\s+|\s+$/g,""),e==a)return unescape(c)}function kkFormatCurrency(a){a=parseFloat(a);isNaN(a)&&(a=0);a=Math.abs(a);a=parseInt((a+0.0050)*100);a/=100;s=new String(a);s.indexOf(".")<0&&(s+=".00");s.indexOf(".")==s.length-2&&(s+="0");return defaultCurrency?defaultCurrency.symbolLeft+s+defaultCurrency.symbolRight:"$"+s}
function formatDate(a){return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()};
